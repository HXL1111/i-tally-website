import{I as S,M as O,T as c,g as $,a as B,b as T,c as z}from"./index-d7315a6d.js";import{bH as m,bG as e,bX as d,bB as p,bu as u,bv as f,bA as w,bP as E}from"./vendor-32c93a83.js";import{i as A}from"./echarts-65324a59.js";import"./vant-26c42152.js";const L="_wrapper_bzxpi_1",k="_topItem_bzxpi_5",Y="_sign_bzxpi_11",V="_icon_bzxpi_22",N="_bar_wrapper_bzxpi_26",P="_bar_text_bzxpi_31",q="_bar_bzxpi_26",G="_bar_inner_bzxpi_46",i={wrapper:L,topItem:k,sign:Y,icon:V,bar_wrapper:N,bar_text:P,bar:q,bar_inner:G},X=m({props:{data:{type:Array,required:!0}},setup:(t,s)=>()=>e("div",{class:i.wrapper},[t.data.map(({tag:a,amount:n,percent:o})=>e("div",{class:i.topItem},[e("div",{class:i.sign},[e(S,{name:a.sign,class:i.icon},null)]),e("div",{class:i.bar_wrapper},[e("div",{class:i.bar_text},[e("span",null,[" ",a.name,d(" - "),o,d("%")," "]),e("span",null,[" ",d("￥"),e(O,{value:n},null)," "])]),e("div",{class:i.bar},[e("div",{class:i.bar_inner,style:{width:`${o}%`}},null)])])]))])}),H="_charts_t256d_1",K="_center_t256d_5",U="_icon_t256d_12",x={charts:H,center:K,icon:U},W="_wrapper_14320_1",Z="_lineChart_14320_7",j="_empty_14320_11",C={wrapper:W,lineChart:Z,empty:j},J={tooltip:{show:!0,trigger:"axis",formatter:([t])=>{const[s,a]=t.data;return`${new c(new Date(s)).format("YYYY年MM月DD日")} ￥${$(a)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"category",boundaryGap:["3%","0%"],axisLabel:{formatter:t=>new c(new Date(t)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},Q=m({props:{data:{type:Array,required:!0},display:{type:Boolean}},setup:(t,s)=>{const a=p();let n;return u(()=>t.data,()=>{n==null||n.setOption({series:[{data:t.data}]})}),f(()=>{a.value!==void 0&&(n=A(a.value),n.setOption({...J,series:[{data:t.data,type:"line"}]}))}),()=>e("div",{class:C.wrapper},[t.display?e("div",{ref:a,class:C.lineChart},null):e("div",{class:C.empty},[d("不支持显示超过一个月的时间数据")])])}}),R="_pieChart_1df07_1",tt={pieChart:R},et={tooltip:{trigger:"item",formatter:t=>{const{name:s,value:a,percent:n}=t;return`${s}: ￥${$(a)} 占比 ${Math.round(n)}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},at=m({props:{data:{type:Array}},setup:(t,s)=>{const a=p();let n;return f(()=>{a.value!==void 0&&(n=A(a.value),n.setOption({...et,series:[{data:t.data,type:"pie"}]}))}),u(()=>t.data,()=>{n==null||n.setOption({series:[{data:t.data}]})}),()=>e("div",{ref:a,class:tt.pieChart},null)}}),nt=24*3600*1e3,rt=m({props:{startDate:{type:String},endDate:{type:String}},setup:(t,s)=>{const a=p("expenses"),n=p([]);let o=!0;const F=w(()=>{if(!t.startDate||!t.endDate)return[];new c(t.endDate.split(" ")[0]).getTimestamp()-new c(t.startDate).getTimestamp()>26784e5&&(o=!1);const r=[],v=(new Date(t.endDate.split(" ")[0]).getTime()-new Date(t.startDate).getTime())/nt+1;let b=0;for(let y=0;y<v;y++){const g=new c(t.startDate+"T00:00:00.000Z").add(y,"day").getTimestamp();n.value[b]&&new Date(n.value[b].happen_at).getTime()===g?(r.push([new Date(g).toISOString(),n.value[b].amount]),b+=1):r.push([new Date(g).toISOString(),0])}return r}),D=async()=>{if(!t.startDate||!t.endDate)return;const r=await T.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:a.value,group_by:"happen_at",_mock:"itemSummary"});n.value=r.data.groups};f(D),u(()=>a.value,D),u(()=>[t.startDate,t.endDate],D);const _=p([]),I=w(()=>_.value.map(r=>({name:r.tag.name,value:r.amount}))),h=async()=>{if(!t.startDate||!t.endDate)return;const r=await T.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:a.value,group_by:"tag_id",_mock:"itemSummary"},{_autoLoading:!0});_.value=r.data.groups};f(h),u(()=>a.value,h),u(()=>[t.startDate,t.endDate],h);const M=w(()=>{const r=_.value.reduce((l,v)=>l+v.amount,0);return _.value.map(l=>({...l,percent:Math.round(l.amount/r*100)}))});return()=>e("div",{class:x.charts},[e(B,{label:"类型",type:"select",options:[{value:"expenses",text:"支出"},{value:"income",text:"收入"}],modelValue:a.value,"onUpdate:modelValue":r=>a.value=r,direction:"row"},null),n.value.length>0?e(E,null,[e(Q,{data:F.value,display:o},null),e(at,{data:I.value},null),e(X,{data:M.value},null)]):e("div",{class:x.center},[e(S,{name:"bill",class:x.icon},null),e("span",null,[d("未发现账单，试着记一笔哦~")])])])}}),lt=m({props:{name:{type:String}},setup:(t,s)=>()=>e(z,{component:rt,iconName:"left",title:"统计图表",rerenderOnSwitchTab:!0},null)});export{lt as StatisticsPage,lt as default};
