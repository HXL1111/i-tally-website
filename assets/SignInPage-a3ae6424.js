import{bB as g,bH as V,bC as u,bU as k,bT as x,bG as a,bX as d}from"./vendor-32c93a83.js";import{u as O,I,F as N,a as m,B as D,N as F,v as p,h as f,b}from"./index-da143a34.js";import"./vant-26c42152.js";const Q=i=>{const s=g(i);return{ref:s,toggle:()=>s.value=!s.value,on:()=>s.value=!0,off:()=>s.value=!1}},E="_main_189f1_1",T="_title_189f1_4",U="_icon_189f1_11",L="_button_wrapper_189f1_19",l={main:E,title:T,icon:U,button_wrapper:L},P=V({props:{name:{type:String}},setup:(i,s)=>{const y=O(),o=u({email:"",code:""}),c=g(),{ref:M,on:_,off:v}=Q(!1),h=k(),w=x(),t=u({email:[],code:[]}),S=async e=>{var n;if(e.preventDefault(),Object.assign(t,{email:[],code:[]}),Object.assign(t,p(o,[{key:"email",type:"required",message:"必填"},{key:"email",type:"pattern",regex:/[1-9]\d+@qq.com/,message:"请填写正确的邮箱地址"},{key:"code",type:"required",message:"必填"}])),!f(t)){const r=await b.post("session",o).catch(q);localStorage.setItem("jwt",r.data.jwt);const C=(n=w.query.return_to)==null?void 0:n.toString();y.refreshMe(),h.push(C||"/")}},j=e=>{throw e.response.status===422&&Object.assign(t,e.response.data.errors),e},q=e=>{throw e.response.status===422&&Object.assign(t,{email:[],code:e.response.data.errors.email}),e},B=async()=>{Object.assign(t,{email:[],code:[]}),Object.assign(t,p(o,[{key:"email",type:"required",message:"必填"},{key:"email",type:"pattern",regex:/[1-9]\d+@qq.com/,message:"必须是QQ邮箱地址"}])),f(t)||(_(),await b.post("validation_codes",{email:o.email},{_autoLoading:!0}).catch(j).finally(v),c.value.startCount())};return()=>a(F,{iconName:"left",title:"登录"},{default:()=>[a("div",{class:l.main},[a("div",{class:l.title},[a(I,{name:"wallet",class:l.icon},null),a("h1",null,[d("i 记账")])]),a(N,{onSubmit:S},{default:()=>{var e,n;return[a(m,{label:"邮箱地址(只接受QQ邮箱)",type:"text",placeholder:"请输入邮箱，然后点击发送验证码",modelValue:o.email,"onUpdate:modelValue":r=>o.email=r,error:(e=t.email)==null?void 0:e[0]},null),a(m,{ref:c,onClick:B,label:"验证码",type:"validationCode",placeholder:"6 位数字",modelValue:o.code,"onUpdate:modelValue":r=>o.code=r,error:(n=t.code)==null?void 0:n[0]},null),a("div",{class:l.button_wrapper},[a(D,{type:"submit",class:l.button},{default:()=>[d("登录")]})])]}})])]})}});export{P as SignInPage,P as default};
